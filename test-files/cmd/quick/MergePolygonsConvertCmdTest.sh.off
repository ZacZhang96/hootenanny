#!/bin/bash
#set -e

DEBUG_OPT="--trace"

INPUTFILEDIR=test-files/cmd/quick/MergePolygonsCmdTest
OUTPUTFILEDIR=test-output/cmd/quick/MergePolygonsCmdTest

mkdir -p $OUTPUTFILEDIR

# Input: 2 x polygons
# Output: 1 x polygon 
INPUTFILE1=$INPUTFILEDIR/square_polygon.osm
INPUTFILE2=$INPUTFILEDIR/diamond_polygon.osm
OUTPUTFILE=$OUTPUTFILEDIR/union_polygon.osm
OUTPUTFILE_TEMP=$OUTPUTFILEDIR/union_polygon-temp.osm.pbf
COMPAREFILE=$INPUTFILEDIR/union_polygon.osm

hoot cat $DEBUG_OPT $OUTPUTFILE_TEMP $INPUTFILE1 $INPUTFILE2 
hoot convert $DEBUG_OPT -D convert.ops="hoot::UnionPolygonsOp" $OUTPUTFILE_TEMP $OUTPUTFILE
hoot diff $COMPAREFILE $OUTPUTFILE || diff $COMPAREFILE $OUTPUTFILE

# Input: 2 x multipolygons
# Output: 1 x polygon 
INPUTFILE1=$INPUTFILEDIR/multi_polygon1.osm
INPUTFILE2=$INPUTFILEDIR/multi_polygon2.osm
OUTPUTFILE=$OUTPUTFILEDIR/union_multi_both.osm
OUTPUTFILE_TEMP=$OUTPUTFILEDIR/union_multi_both-temp.osm.pbf
COMPAREFILE=$INPUTFILEDIR/union_multi_both.osm

hoot cat $DEBUG_OPT $OUTPUTFILE_TEMP $INPUTFILE1 $INPUTFILE2 
hoot convert $DEBUG_OPT -D convert.ops="hoot::UnionPolygonsOp" $OUTPUTFILE_TEMP $OUTPUTFILE
hoot diff $COMPAREFILE $OUTPUTFILE || diff $COMPAREFILE $OUTPUTFILE
